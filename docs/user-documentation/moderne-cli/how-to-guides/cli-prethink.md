---
sidebar_label: Generating Prethink context locally
description: How to generate Prethink context for AI agents using the Moderne CLI.
---

# How to generate Prethink context with the CLI

This guide walks you through generating Prethink context locally using the Moderne CLI.

For background on what Prethink is and the available recipes, please check out our [Prethink recipes documentation](../../recipes/prethink.md).

## Prerequisites

This guide assumes that you have already [installed and configured the CLI](../getting-started/cli-intro.md#installation-and-configuration) and you are aware of [what Moderne Prethink is](../../recipes/prethink.md).

## Step 1: Clone the repositories

The first thing you'll need to do is come up with the list of repositories that you want to generate Prethink context for. Once you have that list, please ensure they are cloned to a shared directory locally. For instance, this might look like:

```bash
prethink-demo
├── service-a
├── service-b
└── shared-library
```

:::tip
Start with a small subset of repositories to test and iterate quickly. Once everything works, add more repositories as needed.
:::

We recommend using the [mod git sync command](../cli-reference.md#mod-git-sync) to create this shared directory. It can clone repositories from a CSV file or from an existing organization.

## Step 2: Build the LSTs

With the repositories cloned, build or download LSTs to run Prethink recipes on:

```bash
mod build prethink-demo
```

## Step 3: Install Prethink recipes

The Moderne module depends on the OpenRewrite module, so install both:

```bash
mod config recipes jar install org.openrewrite.recipe:rewrite-prethink:LATEST
mod config recipes jar install io.moderne.recipe:rewrite-prethink:LATEST
```

If you only need the core building blocks for custom discovery recipes, you can install just the OpenRewrite module.

## Step 4: Run the Prethink recipe

Run the starter recipe:

```bash
mod run prethink-demo --recipe io.moderne.prethink.UpdatePrethinkContextNoAiStarter
```

This recipe will:

* Discover service endpoints, database connections, external service calls, and messaging patterns
* Map test methods to implementation methods
* Generate a CALM architecture diagram
* Update agent configuration files

After you've run the recipe, make sure to apply the changes so the generated files appear in your working tree:

```bash
mod git apply prethink-demo --last-recipe-run
```

You'll find the generated context in each repository's `.moderne/context/` directory. For details on what files are generated, see our documentation on [what Prethink generates](../../recipes/prethink.md#what-prethink-generates).

## Step 5: Create a custom Prethink recipe (optional)

You can customize which context is generated by creating your own Prethink recipe. Here's an example that focuses only on service endpoints:

```yaml
type: specs.openrewrite.org/v1beta/recipe
name: com.acme.MinimalPrethink
displayName: Minimal Prethink context
description: >-
  Generates basic Prethink context with service endpoints only.
recipeList:
  - io.moderne.prethink.calm.FindProjectMetadata
  - io.moderne.prethink.calm.FindServiceEndpoints
  - org.openrewrite.prethink.ExportContext:
      displayName: Service Endpoints
      shortDescription: REST and HTTP endpoints
      dataTables:
        - io.moderne.prethink.table.ServiceEndpoints
  - org.openrewrite.prethink.UpdateAgentConfig
```

:::warning
You must give your recipes unique names to avoid conflicts with the installed starter recipes.
:::

Once you have your custom recipe defined, install and run it:

```bash
mod config recipes yaml install MyPrethink.yml
mod run prethink-demo --recipe com.acme.MinimalPrethink
```

For more recipe examples, please see our [creating a Prethink recipe documentation](../../../administrator-documentation/moderne-platform/how-to-guides/creating-a-prethink-recipe.md).

## Keeping context up to date

Prethink context should be regenerated as your codebase evolves. You should consider:

* Running Prethink as part of your CI pipeline
* Scheduling periodic regeneration (e.g., weekly)
* Regenerating the context after every major refactor or dependency update

```bash
mod run prethink-demo --recipe io.moderne.prethink.UpdatePrethinkContextNoAiStarter
```

## Next steps

* Publish your recipe to your Moderne recipe marketplace
* Add Prethink generation to your CI/CD pipeline
* Explore AI-enhanced summaries by configuring an LLM provider
